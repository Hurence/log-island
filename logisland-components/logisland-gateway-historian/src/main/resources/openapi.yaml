openapi: "3.0.2"
info:
  description: "A simple search engine API that finds documents according to a query or another document"
  version: "1.0.0"
  title: "Document search engine"
servers:
  - url: http://localhost:8080/v1
    description: Local Server
tags:
  - name: "document"
    description: "Everything about documents"
paths:
  "/timeseries":
    "get":
      tags:
        - timeseries
      "description": Returns desired timeseries, with or without sampling, with or without agregations
      "operationId": "getTimeSeries"
      "parameters":
        - "name": from
          "in": query
          "description": the start of timeseries to look for
          required: true
          schema:
            type: integer
            format: int64
        - "name": to
          "in": query
          "description": the end of timeseries to look for. If not specified look for all data until Long.MAX
          required: false
          schema:
            type: integer
            format: int64
        - "name": name
          "in": query
          "description": the name of the timeserie to look for. If not specified look for all type of timeseries
          required: false
          schema:
            type: array
            items:
              type: string
        - "name": aggs
          "in": query
          "description": the agregations to calculate for the timeserie. If not specified no agregations is calculated.
          required: false
          schema:
            type: array
            items:
              type: string #TODO enum
        - "name": sampling
          #TODO something like that : bucket:100:avg, bucket:50:max ? or maybe specify a max number of pount ?
          #TODO avg:10000 -> moyenn pour le sampling et retourne un maximum de 10000 points
          "in": query
          "description": the algorithm to use to sample data.
          required: false
          schema:
            type: string

      "responses":
        "200":
          "description": A list of timeseries. Maximum number of point returned is 10000 ???
          #TODO is pagination really needed there ? Maybe if user wants to scroll ? But really not sure this is pertinent here
#          "headers":
#            x-next:
#              description: A link to the next page of responses
#              schema:
#                type: string
          "content":
            "application/json":
              "schema":
                "$ref": '#/components/schemas/TimeseriesResponse'
        "500":
          "description": "Something wrong happened"
        default:
          description: unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    Aggs: #TODO sax encoding ? CHUNK_WINDOW_MS ? CHUNK_TREND ? CHUNK_SIZE_BYTES ?
      type: object
      properties:
        min:
          type: number
          format: double
        max:
          type: number
          format: double
        avg:
          type: number
          format: double
        count:
          type: integer
          format: int64
        sum:
          type: number
          format: double
    Timeserie:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        timestamps:
          type: array
          items:
            type: integer
            format: int64
        values:
          type: array
          items:
            type: number
            format: double
        aggs:
          $ref: "#/components/schemas/Aggs"
    TimeseriesResponse:
      type: object
      required:
        - query
        - total_timeseries
        - timeseries
      properties:
        query:
          type: string #TODO return query as requested
        total_timeseries:
          type: integer
          format: int64
        timeseries:
          type: array
          items:
            $ref: "#/components/schemas/Timeserie"
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string
#security:
#externalDocs:

