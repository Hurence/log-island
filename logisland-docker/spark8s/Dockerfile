FROM gcr.io/spark-operator/spark:v2.4.0

LABEL maintainer="support@hurence.com"

COPY ./opencv4/* /usr/local/share/java/opencv4/

ADD ./logisland-*.tar.gz /opt/

RUN cd /opt && ln -s $(eval ls | grep logisland) logisland
ENV LOGISLAND_HOME /opt/logisland
ENV PATH $PATH:$LOGISLAND_HOME/bin
WORKDIR $LOGISLAND_HOME/

COPY log4j* $LOGISLAND_HOME/conf/

COPY classpath_update.sh /opt/logisland/
RUN chmod a+x /opt/logisland/classpath_update.sh

RUN jars="$(/opt/logisland/classpath_update.sh /opt/logisland/lib)" && echo $jars > $LOGISLAND_HOME/logisland_jars.txt

#RUN cat $LOGISLAND_HOME/logisland_jars.txt
#RUN /opt/logisland/classpath_update.sh /opt/logisland/lib

COPY ./main.yml /opt/logisland/conf/

ARG SPARK_EXTRA_CLASSPATH=local:///opt/logisland/lib/plugins/logisland-service-solr_chronix_8-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-solr_8-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-solr_6_6_2-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-rest-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-redis-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-mongodb-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-ip-to-geo-maxmind-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-inmemory-cache-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-influxdb-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-hbase_1_1_2-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-elasticsearch_7_x-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-elasticsearch_6_6_2-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-elasticsearch_5_4_0-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-elasticsearch_2_4_0-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-service-cassandra-client-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-xml-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-web-analytics-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-useragent-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-scripting-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-rest-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-querymatcher-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-outlier-detection-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-hbase-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-excel-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-enrichment-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-elasticsearch-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-cyber-security-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-processor-common-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-connector-spooldir-1.4.0.jar:local:///opt/logisland/lib/plugins/logisland-connector-opc-1.4.0.jar:local:///opt/logisland/lib/cores/zookeeper-3.4.6.jar:local:///opt/logisland/lib/cores/zkclient-0.8.jar:local:///opt/logisland/lib/cores/validation-api-1.1.0.Final.jar:local:///opt/logisland/lib/cores/spring-jcl-5.0.4.RELEASE.jar:local:///opt/logisland/lib/cores/spring-core-5.0.4.RELEASE.jar:local:///opt/logisland/lib/cores/spring-boot-loader-tools-2.0.0.RELEASE.jar:local:///opt/logisland/lib/cores/spring-boot-loader-2.0.0.RELEASE.jar:local:///opt/logisland/lib/cores/snakeyaml-1.24.jar:local:///opt/logisland/lib/cores/slf4j-api-1.7.16.jar:local:///opt/logisland/lib/cores/scala-logging-slf4j_2.10-2.1.2.jar:local:///opt/logisland/lib/cores/scala-logging-api_2.10-2.1.2.jar:local:///opt/logisland/lib/cores/reflectasm-1.07-shaded.jar:local:///opt/logisland/lib/cores/protobuf-java-2.5.0.jar:local:///opt/logisland/lib/cores/opentest4j-1.2.0.jar:local:///opt/logisland/lib/cores/objenesis-2.6.jar:local:///opt/logisland/lib/cores/objenesis-1.2.jar:local:///opt/logisland/lib/cores/netty-3.7.0.Final.jar:local:///opt/logisland/lib/cores/mvel2-2.3.1.Final.jar:local:///opt/logisland/lib/cores/minlog-1.2.jar:local:///opt/logisland/lib/cores/logisland-utils-1.4.0.jar:local:///opt/logisland/lib/cores/logisland-scripting-mvel-1.4.0.jar:local:///opt/logisland/lib/cores/logisland-scripting-base-1.4.0.jar:local:///opt/logisland/lib/cores/logisland-plugin-support-1.4.0.jar:local:///opt/logisland/lib/cores/logisland-bootstrap-1.4.0.jar:local:///opt/logisland/lib/cores/logisland-api-1.4.0.jar:local:///opt/logisland/lib/cores/log4j-to-slf4j-2.10.0.jar:local:///opt/logisland/lib/cores/log4j-api-2.10.0.jar:local:///opt/logisland/lib/cores/kryo-2.21.jar:local:///opt/logisland/lib/cores/junit-vintage-engine-5.5.2.jar:local:///opt/logisland/lib/cores/junit-platform-engine-1.5.2.jar:local:///opt/logisland/lib/cores/junit-platform-commons-1.5.2.jar:local:///opt/logisland/lib/cores/junit-4.12.jar:local:///opt/logisland/lib/cores/json-simple-1.1.jar:local:///opt/logisland/lib/cores/json-20090211.jar:local:///opt/logisland/lib/cores/joda-time-2.8.2.jar:local:///opt/logisland/lib/cores/jline-0.9.94.jar:local:///opt/logisland/lib/cores/jackson-module-jsonSchema-2.10.3.jar:local:///opt/logisland/lib/cores/jackson-dataformat-yaml-2.10.3.jar:local:///opt/logisland/lib/cores/jackson-databind-2.10.3.jar:local:///opt/logisland/lib/cores/jackson-core-2.10.3.jar:local:///opt/logisland/lib/cores/jackson-annotations-2.10.3.jar:local:///opt/logisland/lib/cores/ivy-2.2.0.jar:local:///opt/logisland/lib/cores/hamcrest-core-1.3.jar:local:///opt/logisland/lib/cores/commons-validator-1.6.jar:local:///opt/logisland/lib/cores/commons-logging-1.2.jar:local:///opt/logisland/lib/cores/commons-lang3-3.8.1.jar:local:///opt/logisland/lib/cores/commons-io-2.4.jar:local:///opt/logisland/lib/cores/commons-digester-1.8.1.jar:local:///opt/logisland/lib/cores/commons-compress-1.19.jar:local:///opt/logisland/lib/cores/commons-compress-1.14.jar:local:///opt/logisland/lib/cores/commons-collections-3.2.1.jar:local:///opt/logisland/lib/cores/commons-codec-1.10.jar:local:///opt/logisland/lib/cores/commons-cli-1.2.jar:local:///opt/logisland/lib/cores/commons-beanutils-1.9.2.jar:local:///opt/logisland/lib/cores/cglib-nodep-3.2.10.jar:local:///opt/logisland/lib/cores/avro-1.9.2.jar:local:///opt/logisland/lib/cores/asm-4.0.jar:local:///opt/logisland/lib/cores/apiguardian-api-1.1.0.jar

#ENTRYPOINT ["sh","/opt/logisland/classpath_update.sh","/opt/logisland/lib"]
